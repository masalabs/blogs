<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>使用Helm打造应用商店 - MASA Blogs</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#512bd4"><meta name="application-name" content="MASA Blogs"><meta name="msapplication-TileImage" content="/images/avatar.png"><meta name="msapplication-TileColor" content="#512bd4"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="MASA Blogs"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="1. 简介利用Kubernetes部署一个应用，需要Kubernetes原生资源文件如deployment、replicationcontroller、service或pod 等。而对于一个复杂的应用，会有很多类似上面的资源描述文件，如果有更新或回滚应用的需求，可能要修改和维护所涉及的大量资源文件，且由于缺少对发布过的应用版本管理和控制，使Kubernetes上的应用维护和更新等面临诸多的挑战，而"><meta property="og:type" content="blog"><meta property="og:title" content="使用Helm打造应用商店"><meta property="og:url" content="https://blogs.masastack.com/2022/03/11/independent/helm/getting-started/"><meta property="og:site_name" content="MASA Blogs"><meta property="og:description" content="1. 简介利用Kubernetes部署一个应用，需要Kubernetes原生资源文件如deployment、replicationcontroller、service或pod 等。而对于一个复杂的应用，会有很多类似上面的资源描述文件，如果有更新或回滚应用的需求，可能要修改和维护所涉及的大量资源文件，且由于缺少对发布过的应用版本管理和控制，使Kubernetes上的应用维护和更新等面临诸多的挑战，而"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://s2.loli.net/2022/03/11/4fYHELkGxIMyOeD.png"><meta property="article:published_time" content="2022-03-11T10:00:00.000Z"><meta property="article:modified_time" content="2023-05-26T06:39:56.429Z"><meta property="article:author" content="MASA"><meta property="article:tag" content="K8S"><meta property="article:tag" content="Helm"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://s2.loli.net/2022/03/11/4fYHELkGxIMyOeD.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blogs.masastack.com/2022/03/11/independent/helm/getting-started/"},"headline":"使用Helm打造应用商店","image":["https://s2.loli.net/2022/03/11/4fYHELkGxIMyOeD.png"],"datePublished":"2022-03-11T10:00:00.000Z","dateModified":"2023-05-26T06:39:56.429Z","author":{"@type":"Person","name":"MASA"},"publisher":{"@type":"Organization","name":"MASA Blogs","logo":{"@type":"ImageObject","url":{"text":"MASA Blogs"}}},"description":"1. 简介利用Kubernetes部署一个应用，需要Kubernetes原生资源文件如deployment、replicationcontroller、service或pod 等。而对于一个复杂的应用，会有很多类似上面的资源描述文件，如果有更新或回滚应用的需求，可能要修改和维护所涉及的大量资源文件，且由于缺少对发布过的应用版本管理和控制，使Kubernetes上的应用维护和更新等面临诸多的挑战，而"}</script><link rel="canonical" href="https://blogs.masastack.com/2022/03/11/independent/helm/getting-started/"><link rel="icon" href="/images/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">MASA Blogs</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/masastack"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://s2.loli.net/2022/03/11/4fYHELkGxIMyOeD.png" alt="使用Helm打造应用商店"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-03-11T10:00:00.000Z" title="3/11/2022, 10:00:00 AM">2022-03-11</time>发表</span><span class="level-item"><time dateTime="2023-05-26T06:39:56.429Z" title="5/26/2023, 6:39:56 AM">2023-05-26</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/K8S/">K8S</a><span> / </span><a class="link-muted" href="/categories/K8S/Helm/">Helm</a></span><span class="level-item">1 小时读完 (大约8368个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">使用Helm打造应用商店</h1><div class="content"><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><p>利用Kubernetes部署一个应用，需要Kubernetes原生资源文件如deployment、replicationcontroller、service或pod 等。而对于一个复杂的应用，会有很多类似上面的资源描述文件，如果有更新或回滚应用的需求，可能要修改和维护所涉及的大量资源文件，且由于缺少对发布过的应用版本管理和控制，使Kubernetes上的应用维护和更新等面临诸多的挑战，而Helm可以帮我们解决这些问题。</p>
<p>Helm是目前Kubernetes服务编排领域的唯一开源子项目，做为Kubernetes应用的一个包管理工具，可理解为Kubernetes的apt-get &#x2F; yum，由Deis 公司发起，该公司已经被微软收购。Helm通过软件打包的形式，支持发布的版本管理和控制，很大程度上简化了Kubernetes应用部署和管理的复杂性。</p>
<p>Helm把Kubernetes资源(比如deployments、services或 ingress等) 打包到一个chart中，而chart被保存到chart仓库。通过chart仓库可用来存储和分享chart。Helm使发布可配置，支持发布应用配置的版本管理，简化了Kubernetes部署应用的版本控制、打包、发布、删除、更新等操作。</p>
<span id="more"></span>

<h2 id="Helm架构"><a href="#Helm架构" class="headerlink" title="Helm架构"></a>Helm架构</h2><p><img src="https://s2.loli.net/2022/03/11/cZYPpjhqiwVHkMn.jpg" alt="helm-arch.jpg"></p>
<p>Helm 有两个主要部分：</p>
<p>Helm Client 是最终用户的命令行客户端。客户端负责以下部分：</p>
<ul>
<li>本地 chart 开发</li>
<li>管理存储库</li>
<li>与 Tiller 服务交互</li>
<li>发送要安装的 chart</li>
<li>查询有关发布的信息</li>
<li>请求升级或卸载现有 release</li>
</ul>
<p>Tiller Server 是一个集群内服务，与 Helm 客户端进行交互，并与 Kubernetes API 服务进行交互。服务负责以下内容：</p>
<ul>
<li>监听来自 Helm 客户端的传入请求</li>
<li>结合 chart 和配置来构建发布</li>
<li>将 chart 安装到 Kubernetes 中，然后跟踪后续 release</li>
<li>通过与 Kubernetes 交互来升级和卸载 chart</li>
</ul>
<p>简而言之，客户端负责管理 chart，而服务端负责管理 release。</p>
<h2 id="三大概念"><a href="#三大概念" class="headerlink" title="三大概念"></a>三大概念</h2><p>一个 Chart 是一个 Helm 包。它包含在 Kubernetes 集群内部运行应用程序，工具或服务所需的所有资源定义。把它想像为一个自制软件，一个 Apt dpkg 或一个 Yum RPM 文件的 Kubernetes 环境里面的等价物。</p>
<p>一个 Repository 是 Charts 收集和共享的地方。它就像 Perl 的 CPAN archive 或 Fedora 软件包 repoFedora Package Database。</p>
<p>一个 Release 是处于 Kubernetes 集群中运行的 Chart 的一个实例。一个 chart 通常可以多次安装到同一个群集中。每次安装时，都会创建一个新 release 。比如像一个 MySQL chart。如果希望在群集中运行两个数据库，则可以安装该 chart 两次。每个都有自己的 release，每个 release 都有自己的 release name。</p>
<p>有了这些概念，我们现在可以这样解释 Helm：</p>
<p>Helm 将 charts 安装到 Kubernetes 中，每个安装创建一个新 release 。要找到新的 chart，可以搜索 Helm charts 存储库 repositories。</p>
<p>Helm 使用称为 chart 的包装格式。chart 是描述相关的一组 Kubernetes 资源的文件集合。单个 chart 可能用于部署简单的东西，比如 memcached pod，或者一些复杂的东西，比如完整的具有 HTTP 服务，数据库，缓存等的 Web 应用程序堆栈。</p>
<p>chart 通过创建为特定目录树的文件，将它们打包到版本化的压缩包，然后进行部署。</p>
<p>由于Rancher的应用商店很好的集成了Helm的客户都与服务端，所以本篇将主要讲解 chart 的格式，提供使用 Helm 构建 chart 的基本指导。</p>
<h1 id="2-Chart-文件结构"><a href="#2-Chart-文件结构" class="headerlink" title="2. Chart 文件结构"></a>2. Chart 文件结构</h1><p>chart 被组织为一个目录内的文件集合。目录名称是 chart 的名称（没有版本信息）。例如，描述 WordPress 的 chart 将被存储在 wordpress &#x2F; 目录中。</p>
<p>在这个目录里面，Helm 期望如下这样一个的结构的目录树：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wordpress/</span><br><span class="line">  Chart.yaml          # A YAML file containing information about the chart</span><br><span class="line">  LICENSE             # OPTIONAL: A plain text file containing the license for the chart</span><br><span class="line">  README.md           # OPTIONAL: A human-readable README file</span><br><span class="line">  requirements.yaml   # OPTIONAL: A YAML file listing dependencies for the chart</span><br><span class="line">  values.yaml         # The default configuration values for this chart</span><br><span class="line">  charts/             # A directory containing any charts upon which this chart depends.</span><br><span class="line">  templates/          # A directory of templates that, when combined with values,</span><br><span class="line">                      # will generate valid Kubernetes manifest files.</span><br><span class="line">  templates/NOTES.txt # OPTIONAL: A plain text file containing short usage notes</span><br></pre></td></tr></table></figure>

<p>Helm 保留使用 charts &#x2F; 和 templates &#x2F; 目录以及上面列出的文件名称。其他文件将被忽略。</p>
<h2 id="2-1-Chart-yaml-文件"><a href="#2-1-Chart-yaml-文件" class="headerlink" title="2.1. Chart.yaml 文件"></a>2.1. Chart.yaml 文件</h2><p><code>Chart.yaml</code> 文件是 chart 所必需的。它包含以下字段：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">The</span> <span class="string">chart</span> <span class="string">API</span> <span class="string">version,</span> <span class="string">always</span> <span class="string">&quot;v1&quot;</span> <span class="string">(required)</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">The</span> <span class="string">name</span> <span class="string">of</span> <span class="string">the</span> <span class="string">chart</span> <span class="string">(required)</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">A</span> <span class="string">SemVer</span> <span class="number">2</span> <span class="string">version</span> <span class="string">(required)</span></span><br><span class="line"><span class="attr">kubeVersion:</span> <span class="string">A</span> <span class="string">SemVer</span> <span class="string">range</span> <span class="string">of</span> <span class="string">compatible</span> <span class="string">Kubernetes</span> <span class="string">versions</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">A</span> <span class="string">single-sentence</span> <span class="string">description</span> <span class="string">of</span> <span class="string">this</span> <span class="string">project</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">keywords</span> <span class="string">about</span> <span class="string">this</span> <span class="string">project</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">home:</span> <span class="string">The</span> <span class="string">URL</span> <span class="string">of</span> <span class="string">this</span> <span class="string">project&#x27;s</span> <span class="string">home</span> <span class="string">page</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">sources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">URLs</span> <span class="string">to</span> <span class="string">source</span> <span class="string">code</span> <span class="string">for</span> <span class="string">this</span> <span class="string">project</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">maintainers:</span> <span class="comment"># (optional)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">The</span> <span class="string">maintainer&#x27;s</span> <span class="string">name</span> <span class="string">(required</span> <span class="string">for</span> <span class="string">each</span> <span class="string">maintainer)</span></span><br><span class="line">    <span class="attr">email:</span> <span class="string">The</span> <span class="string">maintainer&#x27;s</span> <span class="string">email</span> <span class="string">(optional</span> <span class="string">for</span> <span class="string">each</span> <span class="string">maintainer)</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">A</span> <span class="string">URL</span> <span class="string">for</span> <span class="string">the</span> <span class="string">maintainer</span> <span class="string">(optional</span> <span class="string">for</span> <span class="string">each</span> <span class="string">maintainer)</span></span><br><span class="line"><span class="attr">engine:</span> <span class="string">gotpl</span> <span class="comment"># The name of the template engine (optional, defaults to gotpl)</span></span><br><span class="line"><span class="attr">icon:</span> <span class="string">A</span> <span class="string">URL</span> <span class="string">to</span> <span class="string">an</span> <span class="string">SVG</span> <span class="string">or</span> <span class="string">PNG</span> <span class="string">image</span> <span class="string">to</span> <span class="string">be</span> <span class="string">used</span> <span class="string">as</span> <span class="string">an</span> <span class="string">icon</span> <span class="string">(optional).</span></span><br><span class="line"><span class="attr">appVersion:</span> <span class="string">The</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">app</span> <span class="string">that</span> <span class="string">this</span> <span class="string">contains</span> <span class="string">(optional).</span> <span class="string">This</span> <span class="string">needn&#x27;t</span> <span class="string">be</span> <span class="string">SemVer.</span></span><br><span class="line"><span class="attr">deprecated:</span> <span class="string">Whether</span> <span class="string">this</span> <span class="string">chart</span> <span class="string">is</span> <span class="string">deprecated</span> <span class="string">(optional,</span> <span class="string">boolean)</span></span><br><span class="line"><span class="attr">tillerVersion: The version of Tiller that this chart requires. This should be expressed as a SemVer range:</span> <span class="string">&quot;&gt;2.0.0&quot;</span> <span class="string">(optional)</span></span><br></pre></td></tr></table></figure>

<p>如果熟悉 <code>Chart.yaml</code> Helm Classic 的文件格式，注意到指定依赖性的字段已被删除。这是因为新的 chart 使用 charts &#x2F; 目录表示依赖关系。</p>
<p>其他字段将被忽略。</p>
<h2 id="2-2-Charts-和版本控制"><a href="#2-2-Charts-和版本控制" class="headerlink" title="2.2. Charts 和版本控制"></a>2.2. Charts 和版本控制</h2><p>每个 chart 都必须有一个版本号。版本必须遵循 <a target="_blank" rel="noopener" href="http://semver.org/">SemVer 2</a> 标准。与 Helm Class 格式不同，Kubernetes Helm 使用版本号作为发布标记。存储库中的软件包由名称加版本识别。</p>
<p>例如，<code>nginx</code> version 字段设置为 1.2.3 将被命名为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.2.3.tgz</span><br></pre></td></tr></table></figure>

<p>更复杂的 SemVer 2 命名也是支持的，例如 version: 1.2.3-alpha.1+ef365。但非 SemVer 命名是明确禁止的。</p>
<p>** 注意 ** ：虽然 Helm Classic 和 Deployment Manager 在 chart 方面都非常适合 GitHub，但 Kubernetes Helm 并不依赖或需要 GitHub 甚至 Git。因此，它不使用 Git SHA 进行版本控制。</p>
<p>许多 Helm 工具都使用 <code>Chart.yaml</code> 的 v<code>ersion</code> 字段，其中包括 CLI 和 Tiller 服务。在生成包时，helm package 命令将使用它在 Chart.yaml 中的版本名作为包名。系统假定 chart 包名称中的版本号与 <code>Chart.yaml</code> 中的版本号相匹配。不符合这个情况会导致错误。</p>
<h2 id="2-3-appVersion-字段"><a href="#2-3-appVersion-字段" class="headerlink" title="2.3. appVersion 字段"></a>2.3. appVersion 字段</h2><p>请注意，<code>appVersion</code> 字段与 <code>version</code> 字段无关。这是一种指定应用程序版本的方法。例如，<code>drupal</code> chart 可能有一个 <code>appVersion: 8.2.1</code>，表示 chart 中包含的 Drupal 版本（默认情况下）是 <code>8.2.1</code>。该字段是信息标识，对 chart 版本没有影响。</p>
<h2 id="弃用-charts"><a href="#弃用-charts" class="headerlink" title="弃用 charts"></a>弃用 charts</h2><p>在管理 chart tepo 库中的 chart 时，有时需要弃用 chart。<code>Chart.yaml</code> 的 d<code>eprecated</code> 字段可用于将 chart 标记为已弃用。如果存储库中最新版本的 chart 标记为已弃用，则整个 chart 被视为已弃用。chart 名称稍后可以通过发布未标记为已弃用的较新版本来重新使用。废弃 chart 的工作流程根据 <a target="_blank" rel="noopener" href="https://github.com/helm/charts">helm&#x2F;charts</a> 项目的工作流程如下：</p>
<ul>
<li>更新 chart 的 <code>Chart.yaml</code> 以将 chart 标记为启用，并且更新版本</li>
<li>在 chart Repository 中发布新的 chart 版本</li>
<li>从源代码库中删除 chart（例如 git）</li>
</ul>
<h2 id="2-4-Chart-许可证文件，自述文件和说明文件"><a href="#2-4-Chart-许可证文件，自述文件和说明文件" class="headerlink" title="2.4. Chart 许可证文件，自述文件和说明文件"></a>2.4. Chart 许可证文件，自述文件和说明文件</h2><p>Chart 还可以包含描述 chart 的安装，配置，使用和许可证的文件。</p>
<p>LICENSE 文件是一个纯文本文件，包含 chart 的 [许可证]（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Software_license%EF%BC%89%E3%80%82">https://en.wikipedia.org/wiki/Software_license）。</a> Chart 可以包含许可证，它可能在模板中具有编程逻辑，因此不仅仅是配置。 如果需要，还可以为 chart 安装的应用程序提供单独的许可证。</p>
<p>Chart 的自述文件应由 Markdown（README.md）语法格式化，并且通常应包含：</p>
<ul>
<li>chart 提供的应用程序或服务的描述</li>
<li>运行 chart 的任何前提条件或要求</li>
<li>选项 <code>values.yaml</code> 和默认值的说明</li>
<li>任何其他可能与安装或配置 chart 相关的信息</li>
</ul>
<p>chart 还可以包含一个简短的纯文本 <code>templates/NOTES.txt</code> 文件，在安装后以及查看版本状态时将打印出来。此文件将作为模板 <a href="#templates-and-values">template</a> 进行评估 ，并可用于显示使用说明，后续步骤或任何其他与发布 chart 相关的信息。例如，可以提供用于连接到数据库或访问 Web UI 的指令。由于运行时，该文件被打印到标准输出 <code>helm install</code> 或 <code>helm status</code>，建议保持内容简短并把更多细节指向自述文件。</p>
<h1 id="3-Chart-依赖关系"><a href="#3-Chart-依赖关系" class="headerlink" title="3. Chart 依赖关系"></a>3. Chart 依赖关系</h1><p>在 Helm 中，一个 chart 可能依赖于任何数量的其他 chart。这些依赖关系可以通过 requirements.yaml 文件动态链接或引入 <code>charts/</code> 目录并手动管理。</p>
<p>虽然有一些团队需要手动管理依赖关系的优势，但声明依赖关系的首选方法是使用 chart 内部的 <code>requirements.yaml</code> 文件。</p>
<p>** 注意：** 传统 Helm 的 Chart.yaml <code>dependencies:</code> 部分字段已被完全删除弃用。</p>
<h2 id="3-1-用-requirements-yaml-来管理依赖关系"><a href="#3-1-用-requirements-yaml-来管理依赖关系" class="headerlink" title="3.1. 用 requirements.yaml 来管理依赖关系"></a>3.1. 用 <code>requirements.yaml</code> 来管理依赖关系</h2><p><code>requirements.yaml</code> 文件是列出 chart 的依赖关系的简单文件。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">apache</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">1.2</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">http://example.com/charts</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">3.2</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">http://another.example.com/charts</span></span><br></pre></td></tr></table></figure>

<ul>
<li>该 name 字段是 chart 的名称。</li>
<li>version 字段是 chart 的版本。</li>
<li>repository 字段是 chart repo 的完整 URL。请注意，还必须使用 helm repo add 添加该 repo 到本地才能使用。</li>
</ul>
<p>有了依赖关系文件，你可以通过运行 <code>helm dependency update</code> ，它会使用你的依赖关系文件将所有指定的 chart 下载到你的 <code>charts/</code> 目录中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ helm dep up foochart</span><br><span class="line">Hang tight while we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the &quot;local&quot; chart repository</span><br><span class="line">...Successfully got an update from the &quot;stable&quot; chart repository</span><br><span class="line">...Successfully got an update from the &quot;example&quot; chart repository</span><br><span class="line">...Successfully got an update from the &quot;another&quot; chart repository</span><br><span class="line">Update Complete. Happy Helming!</span><br><span class="line">Saving 2 charts</span><br><span class="line">Downloading apache from repo http://example.com/charts</span><br><span class="line">Downloading mysql from repo http://another.example.com/charts</span><br></pre></td></tr></table></figure>

<p>当 <code>helm dependency update</code> 检索 chart 时，它会将它们作为 chart 存档存储在 <code>charts/</code> 目录中。因此，对于上面的示例，可以在 chart 目录中看到以下文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">charts/</span><br><span class="line">  apache-1.2.3.tgz</span><br><span class="line">  mysql-3.2.1.tgz</span><br></pre></td></tr></table></figure>

<p>通过 <code>requirements.yaml</code> 管理 chart 是一种轻松更新 chart 的好方法，还可以在整个团队中共享 requirements 信息。</p>
<h2 id="3-2-requirements-yaml-中的-alias-字段"><a href="#3-2-requirements-yaml-中的-alias-字段" class="headerlink" title="3.2. requirements.yaml 中的 alias 字段"></a>3.2. requirements.yaml 中的 <code>alias</code> 字段</h2><p>除上述其他字段外，每个 requirement 条目可能包含可选字段 <code>alias</code>。</p>
<p>为依赖的 chart 添加别名会将 chart 放入依赖关系中，并使用别名作为新依赖关系的名称。</p>
<p>如果需要使用其他名称访问 chart，可以使用 <code>alias</code>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parentchart/requirements.yaml</span></span><br><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">subchart</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">http://localhost:10191</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">alias:</span> <span class="string">new-subchart-1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">subchart</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">http://localhost:10191</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">alias:</span> <span class="string">new-subchart-2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">subchart</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">http://localhost:10191</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<p>在上面的例子中，我们将得到 parentchart 的 3 个依赖关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">subchart</span><br><span class="line">new-subchart-1</span><br><span class="line">new-subchart-2</span><br></pre></td></tr></table></figure>

<p>实现这一目的的手动方法是 <code>charts/</code> 中用不同名称多次复制 &#x2F; 粘贴目录中的同一 chart 。</p>
<h2 id="3-3-requirements-yaml-中的-tags-和-condition-字段"><a href="#3-3-requirements-yaml-中的-tags-和-condition-字段" class="headerlink" title="3.3. requirements.yaml 中的 tags 和 condition 字段"></a>3.3. requirements.yaml 中的 <code>tags</code> 和 <code>condition</code> 字段</h2><p>除上述其他字段外，每个需求条目可能包含可选字段 <code>tags</code> 和 <code>condition</code>。</p>
<p>所有 charts 都会默认加载。如果存在 <code>tags</code> 或 <code>condition</code> 字段，将对它们进行评估并用于控制应用的 chart 的加载。</p>
<p>Condition - condition 字段包含一个或多个 YAML 路径（用逗号分隔）。如果此路径存在于顶级父级的值中并且解析为布尔值，则将根据该布尔值启用或禁用 chart。只有在列表中找到的第一个有效路径才被评估，如果没有路径存在，那么该条件不起作用。</p>
<p>Tags - 标签字段是与此 chart 关联的 YAML 标签列表。在顶级父级的值中，可以通过指定标签和布尔值来启用或禁用所有带有标签的 chart。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parentchart/requirements.yaml</span></span><br><span class="line">dependencies:</span><br><span class="line">      - name: subchart1</span><br><span class="line">        repository: http://localhost:10191</span><br><span class="line">        version: 0.1.0</span><br><span class="line">        condition: subchart1.enabled, global.subchart1.enabled</span><br><span class="line">        tags:</span><br><span class="line">          - front-end</span><br><span class="line">          - subchart1</span><br><span class="line"></span><br><span class="line">      - name: subchart2</span><br><span class="line">        repository: http://localhost:10191</span><br><span class="line">        version: 0.1.0</span><br><span class="line">        condition: subchart2.enabled,global.subchart2.enabled</span><br><span class="line">        tags:</span><br><span class="line">          - back-end</span><br><span class="line">          - subchart2</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parentchart/values.yaml</span></span><br><span class="line"></span><br><span class="line">subchart1:</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">tags:</span><br><span class="line">  front-end: <span class="literal">false</span></span><br><span class="line">  back-end: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>在上面的示例中，所有带有标签的 <code>front-end 的 </code>charts 都将被禁用，但由于 <code>subchart1.enabled</code> 的值在父项值中为 “真”，因此条件将覆盖该 <code>front-end</code> 标签，<code>subchart1</code> 会启用。</p>
<p>由于 <code>subchart2</code> 被标记 <code>back-end</code> 和标签的计算结果为 <code>true</code>，<code>subchart2</code> 将被启用。还要注意的是，虽然 <code>subchart2</code> 有一个在 <code>requirements.yaml</code> 中指定的条件，但父项的值中没有对应的路径和值，因此条件无效。</p>
<h2 id="3-4-使用命令行时带有-tag-和-conditions"><a href="#3-4-使用命令行时带有-tag-和-conditions" class="headerlink" title="3.4. 使用命令行时带有 tag 和 conditions"></a>3.4. 使用命令行时带有 tag 和 conditions</h2><p><code>--set</code> 参数可使用来更改 tag 和 conditions 值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm install --<span class="built_in">set</span> tags.front-end=<span class="literal">true</span> --<span class="built_in">set</span> subchart2.enabled=<span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-5-tags-和-conditions-解析"><a href="#3-5-tags-和-conditions-解析" class="headerlink" title="3.5. tags 和 conditions 解析"></a>3.5. <code>tags</code> 和 <code>conditions</code> 解析</h2><ul>
<li>**Conditions (设置 values) 会覆盖 tags 配置.**。第一个存在的 condition 路径生效，后续该 chart 的 condition 路径将被忽略。</li>
<li>如果 chart 的某 tag 的任一 tag 的值为 true，那么该 tag 的值为 true，并启用这个 chart。</li>
<li>Tags 和 conditions 值必须在顶级父级的值中进行设置。</li>
<li><code>tags:</code> 值中的关键字必须是顶级关键字。目前不支持全局和嵌套 <code>tags:</code> 表格。</li>
</ul>
<h2 id="3-6-通过-requirements-yaml-导入子值"><a href="#3-6-通过-requirements-yaml-导入子值" class="headerlink" title="3.6. 通过 requirements.yaml 导入子值"></a>3.6. 通过 requirements.yaml 导入子值</h2><p>在某些情况下，希望允许子 chart 的值传到父 chart 并作为通用默认值共享。使用这种 exports 格式的另一个好处是它可以使未来的工具能够考虑用户可设置的值。</p>
<p>要导入的值的键可以在父 chart 文件中 <code>requirements.yaml</code> 使用 YAML list 指定。list 中的每个项目都是从子 chart <code>exports</code> 字段导入的 key。</p>
<p>要导入不包含在 exports key 中的值，请使用子父级 <a href="#using-the-child-parent-format">child-parent</a> 格式。下面描述了两种格式的例子。</p>
<h2 id="使用-exports-格式"><a href="#使用-exports-格式" class="headerlink" title="使用 exports 格式"></a>使用 exports 格式</h2><p>如果子 chart 的 values.yaml 文件 exports 在根目录中包含一个字段，则可以通过指定要导入的关键字将其内容直接导入到父项的值中，如下例所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parent&#x27;s requirements.yaml file</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    <span class="attr">import-values:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># child&#x27;s values.yaml file</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">exports:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">myint:</span> <span class="number">99</span></span><br></pre></td></tr></table></figure>

<p>由于我们在导入列表中指定了 <code>data</code> 键，因此 Helm 会在 exports 子图的字段中查找 data 键并导入其内容。</p>
<p>最终的父值将包含我们的导出字段：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parent&#x27;s values file</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">myint:</span> <span class="number">99</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>请注意，父键 data 不包含在父 chart 的最终值中。如果需要指定父键，请使用’child-parent’格式。</p>
<h2 id="3-7-使用-child-parent-格式"><a href="#3-7-使用-child-parent-格式" class="headerlink" title="3.7. 使用 child-parent 格式"></a>3.7. 使用 child-parent 格式</h2><p>要访问未包含在子 chart 键值 <code>exports</code> 的中的值，需要指定要导入的值的源键（<code>child</code>）和父 chart 值（<code>parent</code>）中的目标路径。</p>
<p>下面的例子中的 <code>import-values</code> 告诉 Helm 去拿在 <code>child:</code> 路径发现的任何值，并将其复制到父值 <code>parent:</code> 指定的路径</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parent&#x27;s requirements.yaml file</span></span><br><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">subchart1</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">http://localhost:10191</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    <span class="attr">import-values:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">child:</span> <span class="string">default.data</span></span><br><span class="line">        <span class="attr">parent:</span> <span class="string">myimports</span></span><br></pre></td></tr></table></figure>

<p>在上面的例子中，在 subchart1<code>default.data</code> 的值中找到的值将被导入到父 chart 值中 <code>myimports</code> 的键值，详细如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parent&#x27;s values.yaml file</span></span><br><span class="line"></span><br><span class="line"><span class="attr">myimports:</span></span><br><span class="line">  <span class="attr">myint:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">mybool:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">mystring:</span> <span class="string">&quot;helm rocks!&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># subchart1&#x27;s values.yaml file</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">myint:</span> <span class="number">999</span></span><br><span class="line">    <span class="attr">mybool:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>父 chart 的结果值为：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parent&#x27;s final values</span></span><br><span class="line"></span><br><span class="line"><span class="attr">myimports:</span></span><br><span class="line">  <span class="attr">myint:</span> <span class="number">999</span></span><br><span class="line">  <span class="attr">mybool:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mystring:</span> <span class="string">&quot;helm rocks!&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>父 chart 的最终值现在包含从 subchart1 导入的 <code>myint</code> 和 <code>mybool</code> 字段。</p>
<h2 id="3-8-通过-charts-目录手动管理依赖性"><a href="#3-8-通过-charts-目录手动管理依赖性" class="headerlink" title="3.8. 通过 charts/ 目录手动管理依赖性"></a>3.8. 通过 <code>charts/</code> 目录手动管理依赖性</h2><p>如果需要更多的控制依赖关系，可以通过将依赖的 charts 复制到 <code>charts/</code> 目录中来明确表达这些依赖关系 。</p>
<p>依赖关系可以是 chart 归档（<code>foo-1.2.3.tgz</code>）或解压缩的 chart 目录。但它的名字不能从 <code>_</code> 或 <code>.</code> 开始。这些文件被 chart 加载器忽略。</p>
<p>例如，如果 WordPress chart 依赖于 Apache chart，则在 WordPress chart 的 <code>charts/</code> 目录中提供（正确版本的）Apache chart：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wordpress:</span><br><span class="line">  Chart.yaml</span><br><span class="line">  requirements.yaml</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  charts/</span><br><span class="line">    apache/</span><br><span class="line">      Chart.yaml</span><br><span class="line">      <span class="comment"># ...</span></span><br><span class="line">    mysql/</span><br><span class="line">      Chart.yaml</span><br><span class="line">      <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>上面的示例显示了 WordPress chart 如何通过在其 <code>charts/</code> 目录中包含这些 charts 来表示它对 Apache 和 MySQL 的依赖关系。</p>
<p>** 提示：** 将依赖项放入 charts &#x2F; 目录，请使用 <code> helm fetch</code> 命令</p>
<h2 id="3-9-使用依赖关系的操作方面影响"><a href="#3-9-使用依赖关系的操作方面影响" class="headerlink" title="3.9. 使用依赖关系的操作方面影响"></a>3.9. 使用依赖关系的操作方面影响</h2><p>上面的部分解释了如何指定 chart 依赖关系，但是这会如何影响使用 <code>helm install</code> 和 <code>helm upgrade</code> 的 chart 安装？</p>
<p>假设名为 “A” 的 chart 创建以下 Kubernetes 对象</p>
<ul>
<li>namespace “A-Namespace”</li>
<li>statefulset “A-StatefulSet”</li>
<li>service “A-Service”</li>
</ul>
<p>此外，A 依赖于创建对象的 chart B.</p>
<ul>
<li>namespace “B-Namespace”</li>
<li>replicaset “B-ReplicaSet”</li>
<li>service “B-Service”</li>
</ul>
<p>安装 &#x2F; 升级 chart A 后，会创建 &#x2F; 修改单个 Helm 版本。该版本将按以下顺序创建 &#x2F; 更新所有上述 Kubernetes 对象：</p>
<ul>
<li>A-Namespace</li>
<li>B-Namespace</li>
<li>A-StatefulSet</li>
<li>B-ReplicaSet</li>
<li>A-Service</li>
<li>B-Service</li>
</ul>
<p>这是因为当 Helm 安装 &#x2F; 升级 charts 时，charts 中的 Kubernetes 对象及其所有依赖项都是如下</p>
<ul>
<li>聚合成一个单一的集合; 然后</li>
<li>按类型排序，然后按名称排序; 接着</li>
<li>按该顺序创建 &#x2F; 更新。</li>
</ul>
<p>因此，单个 release 是使用 charts 及其依赖关系创建的所有对象。</p>
<p>Kubernetes 类型的安装顺序由 kind_sorter.go 中的枚举 InstallOrder 给出（<a target="_blank" rel="noopener" href="https://github.com/helm/blob/master/pkg/tiller/kind_sorter.go#L26">the Helm source file</a>)）。</p>
<h1 id="4-模板-Templates-和值-Values"><a href="#4-模板-Templates-和值-Values" class="headerlink" title="4. 模板 Templates 和值 Values"></a>4. 模板 Templates 和值 Values</h1><p>Helm chart 模板是用 Go 模板语言 <a target="_blank" rel="noopener" href="https://golang.org/pkg/text/template/">Go template language</a> 编写的 ，其中添加了来自 Sprig 库 <a target="_blank" rel="noopener" href="https://github.com/Masterminds/sprig">from the Sprig library</a> 的 50 个左右的附加模板函数以及一些其他专用函数 <a href="charts_tips_and_tricks.md">specialized functions</a>。</p>
<p>所有模板文件都存储在 chart 的 templates &#x2F; 文件夹中。当 Helm 渲染 charts 时，它将通过模板引擎传递该目录中的每个文件。</p>
<p>模板的值有两种提供方法：</p>
<ul>
<li>chart 开发人员可能会在 chart 内部提供一个 values.yaml 文件。该文件可以包含默认值。</li>
<li>chart 用户可能会提供一个包含值的 YAML 文件。这可以通过命令行提供 <code>helm install -f</code>。</li>
</ul>
<p>当用户提供自定义值时，这些值将覆盖 chart 中 v<code>alues.yaml</code> 文件中的值。</p>
<h2 id="4-1-模板文件"><a href="#4-1-模板文件" class="headerlink" title="4.1. 模板文件"></a>4.1. 模板文件</h2><p>模板文件遵循用于编写 Go 模板的标准约定（请参阅文 <a target="_blank" rel="noopener" href="https://golang.org/pkg/text/template/">the text&#x2F;template Go package documentation</a> 以了解详细信息）。示例模板文件可能如下所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deis-database</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">deis</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/managed-by:</span> <span class="string">deis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">deis-database</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/name:</span> <span class="string">deis-database</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">deis-database</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">deis-database</span></span><br><span class="line">          <span class="attr">image:</span> &#123;&#123;<span class="string">.Values.imageRegistry</span>&#125;&#125;<span class="string">/postgres:&#123;&#123;.Values.dockerTag&#125;&#125;</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> &#123;&#123;<span class="string">.Values.pullPolicy</span>&#125;&#125;</span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5432</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_STORAGE</span></span><br><span class="line">              <span class="attr">value:</span> &#123;&#123;<span class="string">default</span> <span class="string">&quot;minio&quot;</span> <span class="string">.Values.storage</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>上面的示例基于 <a target="_blank" rel="noopener" href="https://github.com/deis/charts">此网址</a>，是 Kubernetes replication controller 的模板。它可以使用以下四个模板值（通常在 values.yaml 文件中定义 ）：</p>
<ul>
<li>imageRegistry：Docker 镜像的源。</li>
<li>dockerTag：docker 镜像的标签。</li>
<li>pullPolicy：Kubernetes 镜像拉取策略。</li>
<li>storage：存储后端，其默认设置为 <code>&quot;minio&quot;</code></li>
</ul>
<p>所有这些值都由模板作者定义。Helm 不需要或指定参数。</p>
<p>要查更多 charts，请查看 Kubernetes charts 项目</p>
<h2 id="4-2-预定义值"><a href="#4-2-预定义值" class="headerlink" title="4.2. 预定义值"></a>4.2. 预定义值</h2><p>通过 <code>values.yaml</code> 文件（或通过 <code>--set</code> 标志）提供的值可以从 <code>.Values</code> 模板中的对象访问。可以在模板中访问其他预定义的数据片段。</p>
<p>以下值是预定义的，可用于每个模板，并且不能被覆盖。与所有值一样，名称区分大小写。</p>
<ul>
<li><code>Release.Name</code>：release 的名称（不是 chart 的）</li>
<li><code>Release.Time</code>：chart 版本上次更新的时间。这将匹配 <code>Last Released</code> 发布对象上的时间。</li>
<li><code>Release.Namespace</code>：chart release 发布的 namespace。</li>
<li><code>Release.Service</code>：处理 release 的服务。通常是 Tiller。</li>
<li><code>Release.IsUpgrade</code>：如果当前操作是升级或回滚，则设置为 true。</li>
<li><code>Release.IsInstall</code>：如果当前操作是安装，则设置为 true。</li>
<li><code>Release.Revision</code>：版本号。它从 1 开始，并随着每个 <code>helm upgrade</code> 增加。</li>
<li><code>Chart</code>：<code>Chart.yaml</code> 的内容。chart 版本可以从 <code>Chart.Version</code> 和维护人员 <code>Chart.Maintainers</code> 一起获得。</li>
<li><code>Files</code>：包含 chart 中所有非特殊文件的 map-like 对象。不会允许你访问模板，但会让你访问存在的其他文件（除非它们被排除使用 <code>.helmignore</code>）。可以使用 index .Files “file.name” 或使用. Files.Get name 或 .Files.GetString name 功能来访问文件。也可以使用. Files.GetBytes 访问该文件的内容 <code>[byte]</code></li>
<li>Capabilities：包含有关 Kubernetes 版本信息的 map-like 对象（.Capabilities.KubeVersion)，Tiller（.Capabilities.TillerVersion) 和支持的 Kubernetes API 版本（.Capabilities.APIVersions.Has “batch&#x2F;v1”）</li>
</ul>
<p>** 注意:** 任何未知的 Chart.yaml 字段将被删除。它们不会在 chart 对象内部被访问。因此，Chart.yaml 不能用于将任意结构化的数据传递到模板中。values 文件可以用于传递。</p>
<h2 id="4-3-值-values-文件"><a href="#4-3-值-values-文件" class="headerlink" title="4.3. 值 values 文件"></a>4.3. 值 values 文件</h2><p>考虑到上一节中的模板 <code>values.yaml</code>，提供了如下必要值的信息：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">imageRegistry:</span> <span class="string">&quot;quay.io/deis&quot;</span></span><br><span class="line"><span class="attr">dockerTag:</span> <span class="string">&quot;latest&quot;</span></span><br><span class="line"><span class="attr">pullPolicy:</span> <span class="string">&quot;Always&quot;</span></span><br><span class="line"><span class="attr">storage:</span> <span class="string">&quot;s3&quot;</span></span><br></pre></td></tr></table></figure>

<p>values 文件是 YAML 格式的。chart 可能包含一个默认 values.yaml 文件。Helm install 命令允许用户通过提供额外的 YAML 值来覆盖值：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm install --values=myvals.yaml wordpress</span><br></pre></td></tr></table></figure>

<p>当以这种方式传递值时，它们将被合并到默认 values 文件中。例如，考虑一个如下所示的 myvals.yaml 文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span> <span class="string">&quot;gcs&quot;</span></span><br></pre></td></tr></table></figure>

<p>当它与 chart 中 values.yaml 的内容合并时，生成的内容将为：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">imageRegistry:</span> <span class="string">&quot;quay.io/deis&quot;</span></span><br><span class="line"><span class="attr">dockerTag:</span> <span class="string">&quot;latest&quot;</span></span><br><span class="line"><span class="attr">pullPolicy:</span> <span class="string">&quot;Always&quot;</span></span><br><span class="line"><span class="attr">storage:</span> <span class="string">&quot;gcs&quot;</span></span><br></pre></td></tr></table></figure>

<p>注意只有最后一个字段被覆盖了，其他的不变。</p>
<p>** 注：** 包含在 chart 内的默认 values 文件必须命名 <code>values.yaml</code>。但是在命令行上指定的文件可以被命名为任何名称。</p>
<p>** 注：** 如果在 helm install 或 helm upgrade 使用 <code>--set</code>，则这些值仅在客户端转换为 YAML。</p>
<p>** 注意：** 如果 values 文件中存在任何必需的条目，则可以使用’required’功能 <a href="charts_tips_and_tricks-zh_cn.md">‘required’ function</a> 在 chart 模板中声明它们</p>
<p>然后可以在模板内部访问任何这些 <code>.Values</code> 对象值 ：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deis-database</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">deis</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/managed-by:</span> <span class="string">deis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">deis-database</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/name:</span> <span class="string">deis-database</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">deis-database</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">deis-database</span></span><br><span class="line">          <span class="attr">image:</span> &#123;&#123;<span class="string">.Values.imageRegistry</span>&#125;&#125;<span class="string">/postgres:&#123;&#123;.Values.dockerTag&#125;&#125;</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> &#123;&#123;<span class="string">.Values.pullPolicy</span>&#125;&#125;</span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5432</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_STORAGE</span></span><br><span class="line">              <span class="attr">value:</span> &#123;&#123;<span class="string">default</span> <span class="string">&quot;minio&quot;</span> <span class="string">.Values.storage</span>&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-4-范围-Scope，依赖-Dependencies-和值-Values"><a href="#4-4-范围-Scope，依赖-Dependencies-和值-Values" class="headerlink" title="4.4. 范围 Scope，依赖 Dependencies 和值 Values"></a>4.4. 范围 Scope，依赖 Dependencies 和值 Values</h2><p>values 文件可以声明顶级 chart 的值，也可以为 chart 的 charts &#x2F; 目录中包含的任何 chart 声明值。或者，用不同的方式来描述它，values 文件可以为 chart 及其任何依赖项提供值。例如，上面的演示 WordPresschart 具有 mysql 和 apache 依赖性。values 文件可以为所有这些组件提供值：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">&quot;My WordPress Site&quot;</span> <span class="comment"># Sent to the WordPress template</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mysql:</span></span><br><span class="line">  <span class="attr">max_connections:</span> <span class="number">100</span> <span class="comment"># Sent to MySQL</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apache:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span> <span class="comment"># Passed to Apache</span></span><br></pre></td></tr></table></figure>

<p>更高级别的 chart 可以访问下面定义的所有变量。所以 WordPresschart 可以访问 MySQL 密码 <code>.Values.mysql.password</code>。但较低级别的 chart 无法访问父 chart 中的内容，因此 MySQL 将无法访问该 <code>title</code> 属性。同样的，也不能访问 <code>apache.port</code>。</p>
<p>值是命名空间限制的，但命名空间已被修剪。因此对于 WordPresschart 来说，它可以访问 MySQL 密码字段 <code>.Values.mysql.password</code>。但是对于 MySQL chart 来说，这些值的范围已经减小了，并且删除了名 namespace 前缀，所以它会将密码字段简单地视为 <code>.Values.password</code>。</p>
<h2 id="4-5-全局值"><a href="#4-5-全局值" class="headerlink" title="4.5. 全局值"></a>4.5. 全局值</h2><p>从 2.0.0-Alpha.2 开始，Helm 支持特殊的 “全局” 值。考虑前面例子的这个修改版本：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">&quot;My WordPress Site&quot;</span> <span class="comment"># Sent to the WordPress template</span></span><br><span class="line"></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">MyWordPress</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mysql:</span></span><br><span class="line">  <span class="attr">max_connections:</span> <span class="number">100</span> <span class="comment"># Sent to MySQL</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apache:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span> <span class="comment"># Passed to Apache</span></span><br></pre></td></tr></table></figure>

<p>上面添加了一个 global 区块，值 <code>app: MyWordPress</code>。此值可供所有 chart 使用 <code>.Values.global.app</code>。</p>
<p>比如，该 mysql 模板可以访问 <code>app</code> 如. Values.global.app，apache chart 也同样的。上面的 values 文件是这样高效重新生成的：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">&quot;My WordPress Site&quot;</span> <span class="comment"># Sent to the WordPress template</span></span><br><span class="line"></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">MyWordPress</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mysql:</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">MyWordPress</span></span><br><span class="line">  <span class="attr">max_connections:</span> <span class="number">100</span> <span class="comment"># Sent to MySQL</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apache:</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">MyWordPress</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span> <span class="comment"># Passed to Apache</span></span><br></pre></td></tr></table></figure>

<p>这提供了一种与所有子 chart 共享一个顶级变量的方法，这对设置 metadata 中像标签这样的属性很有用。</p>
<p>如果子 chart 声明了一个全局变量，则该全局将向下传递 （到子 chart 的子 chart），但不向上传递到父 chart。子 chart 无法影响父 chart 的值。</p>
<p>此外，父 chart 的全局变量优先于子 chart 中的全局变量。</p>
<h2 id="4-6-参考"><a href="#4-6-参考" class="headerlink" title="4.6. 参考"></a>4.6. 参考</h2><p>当涉及到编写模板和 values 文件时，有几个标准参考可以帮助你。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://godoc.org/text/template">Go templates</a></li>
<li><a target="_blank" rel="noopener" href="https://godoc.org/github.com/Masterminds/sprig">Extra template functions</a></li>
<li><a target="_blank" rel="noopener" href="http://yaml.org/spec/">The YAML format</a></li>
</ul>
<h2 id="4-7-在Rancher中自定义应用商店"><a href="#4-7-在Rancher中自定义应用商店" class="headerlink" title="4.7. 在Rancher中自定义应用商店"></a>4.7. 在Rancher中自定义应用商店</h2><h1 id="5-应用商店概述"><a href="#5-应用商店概述" class="headerlink" title="5. 应用商店概述"></a>5. 应用商店概述</h1><p>在Rancher中提供基于helm的应用商店，通过应用商店能够快速和容易的重复部署应用。应用商店的charts来源即可以是helm仓库或者git仓库，其中包含现成的用于部署的应用程序。应用程序捆绑在称为charts的对象中。charts是Helm推广的封装格式。可以将它们视为部署模板，对于每个Helm，图表是：描述相关Kubernetes资源集的文件集合。使用单个charts即可以部署简单的应用，例如memcached pod；也可以部署复杂的应用，例如具有HTTP服务器，数据库，缓存等的完整Web应用程序堆栈。</p>
<p>Rancher自身改进了Helm目录和charts。所有原生的Helm charts都可以在Rancher中运行，但为了提升用户体验，Rancher增加了一些功能。在Rancher中提供了由Rancher官方维护的模板仓库、由Kubernetes社区维护的模板仓库和未经测试验证的应用模板仓库这三种内置的应用商店。另外，也支持添加自定义的应用商店。</p>
<p>在Rancher中提供基于helm的应用商店，通过应用商店能够快速和容易的重复部署应用。</p>
<h1 id="6-自定义应用商店"><a href="#6-自定义应用商店" class="headerlink" title="6. 自定义应用商店"></a>6. 自定义应用商店</h1><p>自定义的应用商店是一个git仓库，URL需要是一个git clone能够处理的，以及以.git结尾的地址。</p>
<h2 id="6-1-Chart类型"><a href="#6-1-Chart类型" class="headerlink" title="6.1. Chart类型"></a>6.1. Chart类型</h2><p>Rancher支持两种charts类型：</p>
<ul>
<li>Helm Charts：原生的Helm charts包含运行应用的所有内容。当部署一个原生的Helm charts时，需要通过Answers配置键值对形式的参数。Helm chart有Helm Stable和Helm Incubators这两种。</li>
<li>Rancher Charts：Rancher charts在原生的helm charts基础上，添加量app-readme.md和questions.yaml这两个文件，以提升用户体验。 Rancher charts的优势：<ul>
<li>增强版本追踪：Helm支持版本化的部署，Rancher增加了追踪和版本历史管理，以显示不同版本之间的变化。</li>
<li>简化应用程序启动：Rancher chart增加简化的charts描述和配置表单，使应用商店中的应用程序部署更加容易。Rancher用户不需要阅读Helm整个列表中的变量来理解如何启动应用程序。</li>
<li>应用资源管理：Rancher追踪所创建的所有资源。用户能够跟踪所有的资源。用户能在一个页面上查看被用来支持应用的工作负载对象。</li>
</ul>
</li>
</ul>
<h2 id="6-2-Chart目录结构"><a href="#6-2-Chart目录结构" class="headerlink" title="6.2. Chart目录结构"></a>6.2. Chart目录结构</h2><p>下表展示了chart的目录结构，在目录中可以看到：charts&#x2F;%application%&#x2F;%app version%&#x2F;。当为应用商店定制charts时，此信息很有用。用Rancher Specific表示的文件专门用于于Rancher chart，但对于chart自定义是可选的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">├── charts/                                 包含依赖charts的目录</span><br><span class="line">│   ├── Chart.yml                           helm chart信息文件</span><br><span class="line">│   ├── questions.yml                       !Rancher需要!： 包含在Rancher界面中显示的请求。</span><br><span class="line">│   ├── README.md                           可选：在Rancher UI中显示的Helm说明文件。</span><br><span class="line">│   └── requirements.yml                    可选：列出chart依赖关系的YAML文件。</span><br><span class="line">├── templates/                              模板目录，当与values.yml结合使用时，会生成Kubernetes YAML。</span><br><span class="line">│   └── values.yml                          chart的默认配置文件。</span><br><span class="line">└── app-readme.md                           Rancher需要：在Rancher页面中app描述信息。</span><br></pre></td></tr></table></figure>

<h2 id="6-3-Rancher-Chart额外的文件"><a href="#6-3-Rancher-Chart额外的文件" class="headerlink" title="6.3. Rancher Chart额外的文件"></a>6.3. Rancher Chart额外的文件</h2><p>在创建自己的定制化应用商店之前，需要对Rancher chart和原生helm chart有一个基本的了解。Rancher chart与helm chart在目录结构上有细微的差别，即Rancher chart比helm chart多两个文件。</p>
<ul>
<li>app-readme.md：此文件提供chart的描述文本。下面两张图显示了Rancher chart(包含app-readme.md文件)和原生的Helm chart 之间的区别。左边为Rancher Chart(带有app-readme.md）右边的为Helm Chart。app-readme.md</li>
</ul>
<p><img src="https://s2.loli.net/2022/03/11/BlEYnCU7F6NZ3Va.png" alt="app-readme.png"></p>
<ul>
<li>questions.yml：此文件包含表单的请求信息。这些表单请求用于简化chart的部署，当然，也可以使用键值对来配置部署，但使用questions.yml能够简化这个工作。下面显示了Rancher chart(包含app-readme.md文件)和原生的Helm chart 之间的区别。左边为Rancher Chart(带有app-readme.md）右边的为Helm Chart。questions.yml</li>
</ul>
<p><img src="https://s2.loli.net/2022/03/11/KaExMCsGjoru1LW.png" alt="questions.png"></p>
<p>此参考包含的变量可以在questions.yml中进行使用。</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>类型</th>
<th>是否必需</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>variable</td>
<td>string</td>
<td>true</td>
<td>Define the variable name specified in the&nbsp;<code>values.yml</code>&nbsp;file, using&nbsp;<code>foo.bar</code>&nbsp;for nested objects.</td>
</tr>
<tr>
<td>label</td>
<td>string</td>
<td>true</td>
<td>定义UI标签</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>false</td>
<td>指定变量的描述</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>false</td>
<td>Default to&nbsp;<code>string</code>&nbsp;if not specified (current supported types are string, boolean, int, enum, password, storageclass and hostname).</td>
</tr>
<tr>
<td>required</td>
<td>bool</td>
<td>false</td>
<td>Define if the variable is required or not (true | false)</td>
</tr>
<tr>
<td>default</td>
<td>string</td>
<td>false</td>
<td>指定默认值</td>
</tr>
<tr>
<td>group</td>
<td>string</td>
<td>false</td>
<td>Group questions by input value.</td>
</tr>
<tr>
<td>min_length</td>
<td>int</td>
<td>false</td>
<td>Min character length.</td>
</tr>
<tr>
<td>max_length</td>
<td>int</td>
<td>false</td>
<td>Max character length.</td>
</tr>
<tr>
<td>min</td>
<td>int</td>
<td>false</td>
<td>Min integer length.</td>
</tr>
<tr>
<td>max</td>
<td>int</td>
<td>false</td>
<td>Max integer length.</td>
</tr>
<tr>
<td>options</td>
<td>[]string</td>
<td>false</td>
<td>Specify the options when the variable type is&nbsp;<code>enum</code>, for example: options:<br>
– “ClusterIP”<br>
– “NodePort”<br>
– “LoadBalancer”</td>
</tr>
<tr>
<td>valid_chars</td>
<td>string</td>
<td>false</td>
<td>Regular expression for input chars validation.</td>
</tr>
<tr>
<td>invalid_chars</td>
<td>string</td>
<td>false</td>
<td>Regular expression for invalid input chars validation.</td>
</tr>
<tr>
<td>subquestions</td>
<td>[]subquestion</td>
<td>false</td>
<td>Add an array of subquestions.</td>
</tr>
<tr>
<td>show_if</td>
<td>string</td>
<td>false</td>
<td>Show current variable if conditional variable is true. For example&nbsp;<code>show_if: "serviceType=Nodeport"</code></td>
</tr>
<tr>
<td>show_subquestion_if</td>
<td>string</td>
<td>false</td>
<td>Show subquestions if is true or equal to one of the options. for example&nbsp;<code>show_subquestion_if: "true"</code></td>
</tr>
</tbody>
</table>

<h2 id="6-4-创建定制chart的实例"><a href="#6-4-创建定制chart的实例" class="headerlink" title="6.4. 创建定制chart的实例"></a>6.4. 创建定制chart的实例</h2><p>可以使用Helm Charts或Rancher Charts填充您的自定义商店，建议使用Rancher Charts。</p>
<ol>
<li><p>在gitlab仓库中，构建符合要求的chart目录结构。提示：可以通过拷贝一个来自于Helm Stable或Rancher Library中chart来定制自己的chart。</p>
</li>
<li><p>推荐：创建一个app-readme.md文件。在Rancher UI中，使用此文件为chart标题创建自定义文本。可以使用此文本告知用户如何使用该chart。示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ./app-readme.md</span><br><span class="line"># WordPress ROCKS!</span><br></pre></td></tr></table></figure>
</li>
<li><p>推荐： 创建一个questions.yml文件。此文件用于定义部署的参数，没有此文件的话，用户必须通过键值对手工指定参数。下面的例子创建了一个表单，提示用户设置持久化容量大小和存储类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">categories:</span><br><span class="line">- Blog</span><br><span class="line">- CMS</span><br><span class="line">questions:</span><br><span class="line">- variable: persistence.enabled</span><br><span class="line">default: &quot;false&quot;</span><br><span class="line">description: &quot;Enable persistent volume for WordPress&quot;</span><br><span class="line">type: boolean</span><br><span class="line">required: true</span><br><span class="line">label: WordPress Persistent Volume Enabled</span><br><span class="line">show_subquestion_if: true</span><br><span class="line">group: &quot;WordPress Settings&quot;</span><br><span class="line">subquestions:</span><br><span class="line">- variable: persistence.size</span><br><span class="line">    default: &quot;10Gi&quot;</span><br><span class="line">    description: &quot;WordPress Persistent Volume Size&quot;</span><br><span class="line">    type: string</span><br><span class="line">    label: WordPress Volume Size</span><br><span class="line">- variable: persistence.storageClass</span><br><span class="line">    default: &quot;&quot;</span><br><span class="line">    description: &quot;If undefined or null, uses the default StorageClass. Default to null&quot;</span><br><span class="line">    type: storageclass</span><br><span class="line">    label: Default StorageClass for WordPress</span><br></pre></td></tr></table></figure>
</li>
<li><p>推送定制的chart到gitlab仓库。</p>
</li>
</ol>
<h1 id="7-运用应用商店"><a href="#7-运用应用商店" class="headerlink" title="7. 运用应用商店"></a>7. 运用应用商店</h1><p>下面演示，如何运用自定义的应用商店：</p>
<p>添加自己的应用商店，</p>
<p><img src="https://s2.loli.net/2022/03/11/pPfNDv4kAyc26gM.png" alt="20190118143332.png"></p>
<p><img src="https://s2.loli.net/2022/03/11/6J9A4RXq7LPoDuy.png" alt="20190118143438.png"></p>
<p><img src="https://s2.loli.net/2022/03/11/3PwmgyHOSi6eRV5.png" alt="20190118143518.png"></p>
<p>进入特定的项目查看应用商店的应用，</p>
<p><img src="https://s2.loli.net/2022/03/11/reDoz87bxZ3Chwt.png" alt="20190118143832.png"></p>
<p>至此，你可以开始你的K8S商店之旅了！</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>使用Helm打造应用商店</p><p><a href="https://blogs.masastack.com/2022/03/11/independent/helm/getting-started/">https://blogs.masastack.com/2022/03/11/independent/helm/getting-started/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>MASA</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-03-11</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-05-26</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/K8S/">K8S</a><a class="link-muted mr-2" rel="tag" href="/tags/Helm/">Helm</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/03/14/masa/framework/masa-blazor/3.MASA%20Blazor%E5%85%A5%E9%97%A8%E8%BF%99%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">MASA Blazor入门这一篇就够了</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/03/04/masa/framework/masa-blazor/2.%E4%BD%BF%E7%94%A8MASA.Blazor%E5%86%99%E4%B8%80%E4%B8%AA%E6%A0%87%E5%87%86%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%A1%A8%E6%A0%BC%E9%A1%B5/"><span class="level-item">使用MASA.Blazor写一个标准的查询表格页</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/avatar.png" alt="MASA"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">MASA</p><p class="is-size-6 is-block">Make change easier.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>杭州</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">80</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">22</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">38</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/masastack" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/masastack"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#1-简介"><span class="level-left"><span class="level-item">1</span><span class="level-item">1. 简介</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Helm架构"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Helm架构</span></span></a></li><li><a class="level is-mobile" href="#三大概念"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">三大概念</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2-Chart-文件结构"><span class="level-left"><span class="level-item">2</span><span class="level-item">2. Chart 文件结构</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2-1-Chart-yaml-文件"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">2.1. Chart.yaml 文件</span></span></a></li><li><a class="level is-mobile" href="#2-2-Charts-和版本控制"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">2.2. Charts 和版本控制</span></span></a></li><li><a class="level is-mobile" href="#2-3-appVersion-字段"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">2.3. appVersion 字段</span></span></a></li><li><a class="level is-mobile" href="#弃用-charts"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">弃用 charts</span></span></a></li><li><a class="level is-mobile" href="#2-4-Chart-许可证文件，自述文件和说明文件"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">2.4. Chart 许可证文件，自述文件和说明文件</span></span></a></li></ul></li><li><a class="level is-mobile" href="#3-Chart-依赖关系"><span class="level-left"><span class="level-item">3</span><span class="level-item">3. Chart 依赖关系</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#3-1-用-requirements-yaml-来管理依赖关系"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">3.1. 用 requirements.yaml 来管理依赖关系</span></span></a></li><li><a class="level is-mobile" href="#3-2-requirements-yaml-中的-alias-字段"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">3.2. requirements.yaml 中的 alias 字段</span></span></a></li><li><a class="level is-mobile" href="#3-3-requirements-yaml-中的-tags-和-condition-字段"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">3.3. requirements.yaml 中的 tags 和 condition 字段</span></span></a></li><li><a class="level is-mobile" href="#3-4-使用命令行时带有-tag-和-conditions"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">3.4. 使用命令行时带有 tag 和 conditions</span></span></a></li><li><a class="level is-mobile" href="#3-5-tags-和-conditions-解析"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">3.5. tags 和 conditions 解析</span></span></a></li><li><a class="level is-mobile" href="#3-6-通过-requirements-yaml-导入子值"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">3.6. 通过 requirements.yaml 导入子值</span></span></a></li><li><a class="level is-mobile" href="#使用-exports-格式"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">使用 exports 格式</span></span></a></li><li><a class="level is-mobile" href="#3-7-使用-child-parent-格式"><span class="level-left"><span class="level-item">3.8</span><span class="level-item">3.7. 使用 child-parent 格式</span></span></a></li><li><a class="level is-mobile" href="#3-8-通过-charts-目录手动管理依赖性"><span class="level-left"><span class="level-item">3.9</span><span class="level-item">3.8. 通过 charts/ 目录手动管理依赖性</span></span></a></li><li><a class="level is-mobile" href="#3-9-使用依赖关系的操作方面影响"><span class="level-left"><span class="level-item">3.10</span><span class="level-item">3.9. 使用依赖关系的操作方面影响</span></span></a></li></ul></li><li><a class="level is-mobile" href="#4-模板-Templates-和值-Values"><span class="level-left"><span class="level-item">4</span><span class="level-item">4. 模板 Templates 和值 Values</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#4-1-模板文件"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">4.1. 模板文件</span></span></a></li><li><a class="level is-mobile" href="#4-2-预定义值"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">4.2. 预定义值</span></span></a></li><li><a class="level is-mobile" href="#4-3-值-values-文件"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">4.3. 值 values 文件</span></span></a></li><li><a class="level is-mobile" href="#4-4-范围-Scope，依赖-Dependencies-和值-Values"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">4.4. 范围 Scope，依赖 Dependencies 和值 Values</span></span></a></li><li><a class="level is-mobile" href="#4-5-全局值"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">4.5. 全局值</span></span></a></li><li><a class="level is-mobile" href="#4-6-参考"><span class="level-left"><span class="level-item">4.6</span><span class="level-item">4.6. 参考</span></span></a></li><li><a class="level is-mobile" href="#4-7-在Rancher中自定义应用商店"><span class="level-left"><span class="level-item">4.7</span><span class="level-item">4.7. 在Rancher中自定义应用商店</span></span></a></li></ul></li><li><a class="level is-mobile" href="#5-应用商店概述"><span class="level-left"><span class="level-item">5</span><span class="level-item">5. 应用商店概述</span></span></a></li><li><a class="level is-mobile" href="#6-自定义应用商店"><span class="level-left"><span class="level-item">6</span><span class="level-item">6. 自定义应用商店</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#6-1-Chart类型"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">6.1. Chart类型</span></span></a></li><li><a class="level is-mobile" href="#6-2-Chart目录结构"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">6.2. Chart目录结构</span></span></a></li><li><a class="level is-mobile" href="#6-3-Rancher-Chart额外的文件"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">6.3. Rancher Chart额外的文件</span></span></a></li><li><a class="level is-mobile" href="#6-4-创建定制chart的实例"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">6.4. 创建定制chart的实例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#7-运用应用商店"><span class="level-left"><span class="level-item">7</span><span class="level-item">7. 运用应用商店</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/masalabs/MASA.EShop" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">MASA.EShop</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://github.com/BlazorComponent/MASA.Blazor" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">MASA.Blazor</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://www.cnblogs.com/doddgu/tag/Dapr" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">doddgu&#039;blog</span></span><span class="level-right"><span class="level-item tag">www.cnblogs.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/NET/"><span class="level-start"><span class="level-item">.NET</span></span><span class="level-end"><span class="level-item tag">45</span></span></a><ul><li><a class="level is-mobile" href="/categories/NET/Blazor/"><span class="level-start"><span class="level-item">Blazor</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/NET/Blazor/MASA-Blazor/"><span class="level-start"><span class="level-item">MASA Blazor</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NET/C/"><span class="level-start"><span class="level-item">C#</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/NET/Crank/"><span class="level-start"><span class="level-item">Crank</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/NET/Framework/"><span class="level-start"><span class="level-item">Framework</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/NET/MASA-Auth/"><span class="level-start"><span class="level-item">MASA Auth</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/NET/MASA-Framework/"><span class="level-start"><span class="level-item">MASA Framework</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/categories/NET/Redis/"><span class="level-start"><span class="level-item">Redis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/NET/Template/"><span class="level-start"><span class="level-item">Template</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Dapr/"><span class="level-start"><span class="level-item">Dapr</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/K8S/"><span class="level-start"><span class="level-item">K8S</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/K8S/Helm/"><span class="level-start"><span class="level-item">Helm</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/MASA/"><span class="level-start"><span class="level-item">MASA</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/MASA-Blazor/"><span class="level-start"><span class="level-item">MASA Blazor</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/MASA-Blazor/MAUI/"><span class="level-start"><span class="level-item">MAUI</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/MASA-IoT/"><span class="level-start"><span class="level-item">MASA IoT</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/MASA-Stack/"><span class="level-start"><span class="level-item">MASA Stack</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/MAUI/"><span class="level-start"><span class="level-item">MAUI</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/MAUI/MASA-Blazor/"><span class="level-start"><span class="level-item">MASA Blazor</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%A4%BE%E5%8C%BA%E4%BE%8B%E4%BC%9A/"><span class="level-start"><span class="level-item">社区例会</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%A4%BE%E5%8C%BA%E4%BE%8B%E4%BC%9A/MASA-Stack/"><span class="level-start"><span class="level-item">MASA Stack</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/2023/05/10/MASA%20IoT/%E4%BD%BF%E7%94%A8MASA%E5%85%A8%E5%AE%B6%E6%A1%B6%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAIoT%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%B8%89%EF%BC%89%E7%AE%A1%E7%90%86%E8%AE%BE%E5%A4%87%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81/"><img src="https://cdn.masastack.com/images/MASA%20IoT.png" alt="使用MASA全家桶从零开始搭建IoT平台（三）管理设备的连接状态"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-05-10T15:30:00.000Z">2023-05-10</time></p><p class="title"><a href="/2023/05/10/MASA%20IoT/%E4%BD%BF%E7%94%A8MASA%E5%85%A8%E5%AE%B6%E6%A1%B6%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAIoT%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%B8%89%EF%BC%89%E7%AE%A1%E7%90%86%E8%AE%BE%E5%A4%87%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81/">使用MASA全家桶从零开始搭建IoT平台（三）管理设备的连接状态</a></p><p class="categories"><a href="/categories/MASA-IoT/">MASA IoT</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/05/05/MASA%20IoT/%E4%BD%BF%E7%94%A8MASA%E5%85%A8%E5%AE%B6%E6%A1%B6%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAIoT%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%BA%8C%EF%BC%89%E8%AE%BE%E5%A4%87%E6%B3%A8%E5%86%8C/"><img src="https://cdn.masastack.com/images/MASA%20IoT.png" alt="使用MASA全家桶从零开始搭建IoT平台（二）设备注册"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-05-05T15:32:00.000Z">2023-05-05</time></p><p class="title"><a href="/2023/05/05/MASA%20IoT/%E4%BD%BF%E7%94%A8MASA%E5%85%A8%E5%AE%B6%E6%A1%B6%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAIoT%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%BA%8C%EF%BC%89%E8%AE%BE%E5%A4%87%E6%B3%A8%E5%86%8C/">使用MASA全家桶从零开始搭建IoT平台（二）设备注册</a></p><p class="categories"><a href="/categories/MASA/">MASA</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/04/21/MASA%20IoT/%E4%BD%BF%E7%94%A8MASA%E5%85%A8%E5%AE%B6%E6%A1%B6%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAIoT%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%B8%80%EF%BC%89%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/"><img src="https://cdn.masastack.com/images/MASA%20IoT.png" alt="使用MASA全家桶从零开始搭建IoT平台（一）环境准备"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-04-21T15:30:00.000Z">2023-04-21</time></p><p class="title"><a href="/2023/04/21/MASA%20IoT/%E4%BD%BF%E7%94%A8MASA%E5%85%A8%E5%AE%B6%E6%A1%B6%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAIoT%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%B8%80%EF%BC%89%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/">使用MASA全家桶从零开始搭建IoT平台（一）环境准备</a></p><p class="categories"><a href="/categories/MASA/">MASA</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/03/13/MASA%20Blazor/Blazor%E5%9C%A8IoT%E9%A2%86%E5%9F%9F%E7%9A%84%E5%89%8D%E7%AB%AF%E5%AE%9E%E8%B7%B5%20@.NET%E5%BC%80%E5%8F%91%E8%80%85%E6%97%A5/"><img src="https://cdn.masastack.com/images/blogs/blazor%20in%20iot3.13.jpg" alt="Blazor在IoT领域的前端实践 @.NET开发者日"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-03-13T14:35:00.000Z">2023-03-13</time></p><p class="title"><a href="/2023/03/13/MASA%20Blazor/Blazor%E5%9C%A8IoT%E9%A2%86%E5%9F%9F%E7%9A%84%E5%89%8D%E7%AB%AF%E5%AE%9E%E8%B7%B5%20@.NET%E5%BC%80%E5%8F%91%E8%80%85%E6%97%A5/">Blazor在IoT领域的前端实践 @.NET开发者日</a></p><p class="categories"><a href="/categories/MASA-Blazor/">MASA Blazor</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/03/08/MASA%20Blazor/MASA%20MAUI%20Plugin%20%EF%BC%88%E5%8D%81%EF%BC%89iOS%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%EF%BC%88%E5%8E%9F%E7%94%9FAPNS%E6%96%B9%E5%BC%8F%EF%BC%89/"><img src="https://cdn.masastack.com/images/blogs/masa-blazor-love-maui.jpg" alt="MASA MAUI Plugin （十）iOS消息推送（原生APNS方式）"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-03-08T13:35:00.000Z">2023-03-08</time></p><p class="title"><a href="/2023/03/08/MASA%20Blazor/MASA%20MAUI%20Plugin%20%EF%BC%88%E5%8D%81%EF%BC%89iOS%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%EF%BC%88%E5%8E%9F%E7%94%9FAPNS%E6%96%B9%E5%BC%8F%EF%BC%89/">MASA MAUI Plugin （十）iOS消息推送（原生APNS方式）</a></p><p class="categories"><a href="/categories/MAUI/">MAUI</a> / <a href="/categories/MAUI/MASA-Blazor/">MASA Blazor</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">十二月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">十一月 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/NET/"><span class="tag">.NET</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blazor/"><span class="tag">Blazor</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C-8-0/"><span class="tag">C#8.0</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CQRS/"><span class="tag">CQRS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Caching/"><span class="tag">Caching</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Caller/"><span class="tag">Caller</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Configuration/"><span class="tag">Configuration</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Crank/"><span class="tag">Crank</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DDD/"><span class="tag">DDD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DI/"><span class="tag">DI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Distributed-lock/"><span class="tag">Distributed lock</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/EFCore/"><span class="tag">EFCore</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/EventBus/"><span class="tag">EventBus</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Framework/"><span class="tag">Framework</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Helm/"><span class="tag">Helm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HttpClient/"><span class="tag">HttpClient</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K8S/"><span class="tag">K8S</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MASA-Auth/"><span class="tag">MASA Auth</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MASA-Auth-Design/"><span class="tag">MASA Auth Design</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MASA-Blazor/"><span class="tag">MASA Blazor</span><span class="tag">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MASA-Blazor/"><span class="tag">MASA Blazor#</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MASA-Framework/"><span class="tag">MASA Framework</span><span class="tag">28</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MASA-Framework-Design/"><span class="tag">MASA Framework Design</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MASA-IoT/"><span class="tag">MASA IoT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MASA-Stack/"><span class="tag">MASA Stack</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MAUI/"><span class="tag">MAUI</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mapster/"><span class="tag">Mapster</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Minimal-Api/"><span class="tag">Minimal Api</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MinimalAPIs/"><span class="tag">MinimalAPIs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OM/"><span class="tag">OM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SnowFlake/"><span class="tag">SnowFlake</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Storage/"><span class="tag">Storage</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Template/"><span class="tag">Template</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Test/"><span class="tag">Test</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UI/"><span class="tag">UI</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dapr/"><span class="tag">dapr</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/i18n/"><span class="tag">i18n</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">MASA Blogs</a><p class="is-size-7"><span>&copy; 2023 MASA</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/masastack"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>